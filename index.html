<style>
  body {
    margin: 0;
    padding: 10px;
    background: #2c3e50;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #2c3e50;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    color: white;
    transition: opacity 0.5s;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }

  .loading-screen p {
    color: #3498db;
    margin-top: 10px;
    font-size: 1.1em;
    text-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
  }

  .tips-container {
    max-width: 80%;
    text-align: center;
    padding: 20px;
    background: #34495e;
    border-radius: 10px;
    margin-top: 20px;
    position: relative;
    height: 100px;
  }

  .tips-container h3 {
    color: #3498db;
    margin-bottom: 15px;
    font-size: 1.4em;
    text-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
  }

  .tips-container p.tip {
    opacity: 0;
    transition: opacity 0.5s;
    position: absolute;
    width: 80%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.1em;
    color: #ecf0f1;
    text-shadow: 0 0 2px rgba(0,0,0,0.5);
  }

  .tips-container p.tip.active {
    opacity: 1;
  }

  .tip {
    margin: 10px 0;
    color: #ecf0f1;
  }

  .disclaimer {
    width: 95vw;
    max-width: 600px;
    text-align: center;
    padding: 15px;
    background: #34495e;
    color: #ecf0f1;
    margin-top: 15px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    font-size: 0.9rem;
    line-height: 1.4;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes verticalSpin {
    0% { transform: rotateX(0deg); }
    100% { transform: rotateX(360deg); }
  }

  .cat-spin {
    animation: verticalSpin 0.5s linear;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .game-container {
    width: 95vw;
    max-width: 600px;
    height: 70vh;
    background: #34495e;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
    border: 3px solid #3498db;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .cat {
    width: 60px;
    height: 60px;
    position: absolute;
    cursor: pointer;
    transition: transform 0.2s;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 1; /* Add this line */
  }

  .cat:hover {
    transform: scale(1.1);
  }

  .target-display {
    width: 95vw;
    max-width: 600px;
    text-align: center;
    padding: 15px;
    background: #34495e;
    color: white;
    margin-bottom: 15px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .target-display h2 {
    margin: 0 0 10px 0;
    font-size: 1.5rem;
    color: #3498db;
  }

  .target-cat {
    width: 80px;
    height: 80px;
    border: 3px solid #f1c40f;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(241,196,15,0.5);
    /* Keep existing styles */
    transition: transform 0.2s;
  }

  .target-cat:hover {
    transform: scale(1.1);
  }

  .status-display {
    padding: 5px 10px;
    background: #3498db;
    color: white;
    border-radius: 15px;
    margin-top: 5px;
    font-size: 0.9em;
  }

  .score {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 10px 15px;
    background: #3498db;
    color: white;
    border-radius: 25px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 100; /* Add this line */
  }

  .round-info {
    position: absolute;
    top: 10px;
    left: 10px;
    padding: 10px 15px;
    background: #3498db;
    color: white;
    border-radius: 25px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 100; /* Add this line */
  }

  @media (max-width: 480px) {
    .cat {
      width: 50px;
      height: 50px;
    }

    .target-cat {
      width: 60px;
      height: 60px;
    }

    .target-display h2 {
      font-size: 1.2rem;
    }
  }

  .boss-mode {
    background: rgba(255, 0, 0, 0.2) !important;
    transition: background 1s ease;
  }

  .boss-cat {
    width: 80px !important;
    height: 80px !important;
    filter: drop-shadow(0 0 10px red);
    animation: pulse 0.5s infinite alternate;
    z-index: 2; /* Add this line to ensure boss is above regular cats */
  }

  .boss-clone {
    width: 60px;
    height: 60px;
    position: absolute;
    cursor: default; /* Change cursor since Kendrick clones aren't clickable */
    border-radius: 0 !important;
    filter: brightness(0.7) hue-rotate(180deg);
    transition: transform 0.1s, width 0.3s, height 0.3s;
    z-index: 3; /* Add this line to ensure clones are above boss */
  }

  @keyframes pulse {
    from { transform: scale(1); }
    to { transform: scale(1.2); }
  }

  .game-over-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    color: white;
    text-align: center;
  }

  .game-over-screen h2 {
    color: #e74c3c;
    font-size: 2.5rem;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
  }

  .game-over-screen p {
    font-size: 1.2rem;
    margin: 10px 0;
    color: #ecf0f1;
  }

  .restart-button {
    margin-top: 20px;
    padding: 15px 30px;
    font-size: 1.2rem;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .restart-button:hover {
    transform: scale(1.05);
    background: #2980b9;
  }

  .boss-mode .status-display {
    background: #e74c3c;
    font-weight: bold;
    font-size: 1.1em;
    padding: 8px 15px;
    animation: pulse 1s infinite alternate;
  }

  @keyframes healthPulse {
    from { background: #e74c3c; }
    to { background: #c0392b; }
  }

  .boss-text {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: #ff0000;
    font-family: monospace;
    font-size: 1.2em;
    text-shadow: 0 0 5px #ff0000;
    opacity: 0.9;
    text-align: center;
    z-index: 100; /* Update this line */
    background: rgba(0, 0, 0, 0.5);
    padding: 10px 20px;
    border-radius: 10px;
    white-space: nowrap;
  }

  .boss-text span {
    display: block;
    margin-top: 5px;
    font-style: italic;
  }

  .leaderboard {
    width: 95vw;
    max-width: 600px;
    text-align: center;
    padding: 15px;
    background: #34495e;
    color: white;
    margin-bottom: 15px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex;
    justify-content: space-around;
  }

  .leaderboard-item {
    flex: 1;
    padding: 5px;
  }

  .leaderboard-item h3 {
    color: #3498db;
    margin: 0 0 5px 0;
    font-size: 1.2rem;
  }

  .leaderboard-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #f1c40f;
    text-shadow: 0 0 5px rgba(241, 196, 15, 0.3);
  }

  @keyframes glitch {
    0% {
      transform: translate(0);
      filter: hue-rotate(0deg);
    }
    20% {
      transform: translate(-1px, 1px);
      filter: hue-rotate(45deg);
    }
    40% {
      transform: translate(1px, -1px);
      filter: hue-rotate(90deg);
    }
    60% {
      transform: translate(-1px, -1px);
      filter: hue-rotate(135deg);
    }
    80% {
      transform: translate(1px, 1px);
      filter: hue-rotate(180deg);
    }
    100% {
      transform: translate(0);
      filter: hue-rotate(0deg);
    }
  }

  .target-cat.glitch {
    animation: glitch 0.2s infinite;
  }

  .settings-button {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 8px 15px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    z-index: 1001;
  }

  .settings-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #34495e;
    padding: 20px;
    border-radius: 15px;
    z-index: 1002;
    width: 300px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    display: none;
  }

  .settings-menu.active {
    display: block;
  }

  .settings-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1001;
    display: none;
  }

  .settings-overlay.active {
    display: block;
  }

  .settings-menu h2 {
    color: #3498db;
    margin-top: 0;
    margin-bottom: 20px;
    text-align: center;
  }

  .setting-item {
    margin-bottom: 15px;
  }

  .setting-item label {
    display: block;
    color: white;
    margin-bottom: 5px;
  }

  .setting-item input[type="range"] {
    width: 100%;
  }

  .setting-item input[type="checkbox"] {
    margin-right: 10px;
  }

  .close-settings {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 20px;
  }

  .boss-info-button {
    position: fixed;
    top: 10px;
    left: 10px;
    padding: 8px 15px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    z-index: 1001;
  }

  .boss-info-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #34495e;
    padding: 20px;
    border-radius: 15px;
    z-index: 1002;
    width: 80%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    display: none;
  }

  .boss-info-menu.active {
    display: block;
  }

  .boss-info-item {
    margin-bottom: 30px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    text-align: center;
  }

  .boss-info-item h3 {
    color: #e74c3c;
    margin-top: 0;
    margin-bottom: 10px;
  }

  .boss-info-item p {
    color: #ecf0f1;
    margin: 5px 0;
    line-height: 1.4;
  }

  .boss-info-item .boss-abilities {
    margin-top: 10px;
    padding-left: 20px;
  }

  .boss-info-item .boss-abilities li {
    color: #3498db;
    margin: 5px 0;
  }

  .boss-portrait {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid #e74c3c;
    margin: 10px auto;
    display: block;
    object-fit: cover;
    box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
  }

  .difficulty-meter {
    width: auto;  /* Change from fixed width */
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 15px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 25px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 5px;
    z-index: 100; /* Add this line */
  }

  .difficulty-meter span {
    font-size: 1.1em;
    text-shadow: 0 0 3px rgba(0,0,0,0.5);
    letter-spacing: 1px;
  }

  .difficulty-meter .stars {
    color: #f1c40f;
    text-shadow: 0 0 3px rgba(0,0,0,0.3);
  }

  @keyframes flash {
    0%, 100% { background: rgba(255, 0, 0, 0.2); }
    50% { background: rgba(255, 0, 0, 0.6); }
  }

  .gallery-button {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 15px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    z-index: 1001;
  }

  .gallery-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #34495e;
    padding: 20px;
    border-radius: 15px;
    z-index: 1002;
    width: 80%;
    max-width: 600px;  /* Reduced from 800px */
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    display: none;
  }

  .gallery-menu.active {
    display: block;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Reduced from 200px */
    gap: 15px; /* Reduced from 20px */
    padding: 15px; /* Reduced from 20px */
  }

  .gallery-item {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .gallery-item img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid #3498db;
    margin-bottom: 8px;
    object-fit: cover;
    transition: transform 0.2s;
    display: block; /* Ensure block display */
    margin-left: auto; /* Center horizontally */
    margin-right: auto;
  }

  .gallery-item p {
    color: #ecf0f1;
    font-size: 0.9em;
    margin: 5px 0;
    text-align: center;
    width: 100%;
  }

  .gallery-menu h2 {
    color: #3498db;
    text-align: center;
    margin-bottom: 20px;
  }

  .game-mode-select {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    background: #2c3e50;
    color: white;
    border: 1px solid #3498db;
    margin-top: 5px;
  }

  .game-mode-select option {
    background: #2c3e50;
    color: white;
    padding: 5px;
  }

  @keyframes immunityFlash {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .immunity {
    animation: immunityFlash 0.5s linear;
    pointer-events: none;
  }

  /* Add these styles for the pattern preview section */
  .gallery-section-title {
    width: 100%;
    text-align: center;
    margin: 15px 0; /* Reduced from 20px */
    color: #3498db;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
  }

  .gallery-pattern-item {
    grid-column: span 2;
    background: rgba(0, 0, 0, 0.2);
    padding: 12px; /* Reduced from 15px */
    border-radius: 8px; /* Reduced from 10px */
    text-align: center;
  }

  .gallery-pattern-item h4 {
    color: #3498db;
    margin: 10px 0;
  }

  .gallery-pattern-item p {
    color: #ecf0f1;
    font-size: 0.9em;
    line-height: 1.4;
  }

  .pattern-preview {
    width: 80px; /* Reduced from 100px */
    height: 80px; /* Reduced from 100px */
    background: #2c3e50;
    border-radius: 8px; /* Reduced from 10px */
    margin: 0 auto;
    position: relative;
    overflow: hidden;
  }

  .preview-dot {
    width: 10px;
    height: 10px;
    background: #e74c3c;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  /* Pattern-specific animations */
  .linear .preview-dot {
    animation: linearPreview 2s infinite;
  }

  .circular .preview-dot {
    animation: circularPreview 2s infinite linear;
  }

  .zigzag .preview-dot {
    animation: zigzagPreview 2s infinite;
  }

  .cat\:3 .preview-dot {
    animation: catPreview 3s infinite;
  }

  .find-luigi .preview-dot {
    animation: luigiPreview 2s infinite linear;
  }

  .tlop .preview-dot {
    animation: tlopPreview 1s infinite;
  }

  .why .preview-dot {
    animation: whyPreview 2s infinite linear;
  }

  .shuffle .preview-dot {
    animation: shufflePreview 3s infinite;
  }

  .outside-the-box .preview-dot {
    display: none;
  }

  .boss .preview-dot {
    animation: bossPreview 1s infinite;
  }

  @keyframes linearPreview {
    0%, 100% { transform: translate(-50%, -50%); }
    50% { transform: translate(30px, 30px); }
  }

  @keyframes circularPreview {
    0% { transform: translate(-50%, -50%) rotate(0) translateX(30px) rotate(0); }
    100% { transform: translate(-50%, -50%) rotate(360deg) translateX(30px) rotate(-360deg); }
  }

  @keyframes zigzagPreview {
    0%, 100% { transform: translate(-50%, -50%); }
    25% { transform: translate(20px, -20px); }
    50% { transform: translate(-20px, 0); }
    75% { transform: translate(20px, 20px); }
  }

  @keyframes catPreview {
    0%, 100% { transform: translate(-50%, -50%); }
    25% { transform: translate(-20px, -20px); }
    50% { transform: translate(0, 20px); }
    75% { transform: translate(20px, -20px); }
  }

  @keyframes luigiPreview {
    0% { transform: translate(-50%, -50%) rotate(0) translateX(25px); }
    100% { transform: translate(-50%, -50%) rotate(360deg) translateX(25px); }
  }

  @keyframes tlopPreview {
    0%, 100% { opacity: 1; transform: translate(-50%, -50%); }
    50% { opacity: 0.5; transform: translate(random(40)px, random(40)px); }
  }

  @keyframes whyPreview {
    0% { transform: translate(-50%, -50%); }
    100% { transform: translate(30px, -30px); }
  }

  @keyframes shufflePreview {
    0%, 20% { transform: translate(-50%, -50%); }
    25%, 45% { transform: translate(20px, 20px); }
    50%, 70% { transform: rotate(180deg) translate(20px, 20px); }
    75%, 95% { transform: scale(1.5) translate(-10px, -10px); }
    100% { transform: translate(-50%, -50%); }
  }

  @keyframes bossPreview {
    0%, 100% { transform: translate(-50%, -50%); }
    25% { transform: translate(25px, -25px); }
    50% { transform: translate(-25px, 25px); }
    75% { transform: translate(25px, 25px); }
  }

  /* Update gallery grid for better pattern display */
  .gallery-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Reduced from 200px */
    gap: 15px; /* Reduced from 20px */
    padding: 15px; /* Reduced from 20px */
  }

  .where-is-he {
    width: 120px !important;
    height: 120px !important;
    filter: brightness(1.2) drop-shadow(0 0 10px white);
    z-index: 2;
    cursor: pointer;
  }
</style>
</head>
<body>
<div class="leaderboard">
  <div class="leaderboard-item">
    <h3>Highest Round</h3>
    <div class="leaderboard-value" id="highestRound">0</div>
  </div>
  <div class="leaderboard-item">
    <h3>Highest Score</h3>
    <div class="leaderboard-value" id="highestScore">0</div>
  </div>
</div>

<button class="settings-button">&#x2699;&#xfe0f; Settings</button>
<button class="boss-info-button">&#x2139;&#xfe0f; Boss Info</button>
<button class="gallery-button">&#x1f5bc; Gallery</button>

<div class="settings-overlay"></div>
<div class="settings-menu">
  <button class="close-settings">&#xd7;</button>
  <h2>Settings</h2>
  
  <div class="setting-item">
    <label>
      <input type="checkbox" id="toggleFlashing" checked> Enable Flashing Effects
    </label>
  </div>
  
  <div class="setting-item">
    <label>
      <input type="checkbox" id="toggleBgMusic" checked> Enable Background Music
    </label>
  </div>
  
  <div class="setting-item">
    <label>
      <input type="checkbox" id="toggleSoundEffects" checked> Enable Sound Effects
    </label>
  </div>
  
  <div class="setting-item">
    <label>Background Music Volume</label>
    <input type="range" id="bgMusicVolume" min="0" max="100" value="30">
  </div>
  
  <div class="setting-item">
    <label>Sound Effects Volume</label>
    <input type="range" id="sfxVolume" min="0" max="100" value="20">
  </div>
  
  <div class="setting-item">
    <label>Game Mode</label>
    <select id="gameMode" class="game-mode-select">
      <option value="normal">Normal</option>
      <option value="chill">Chill Mode (No Bosses, Easier)</option>
      <option value="bossrush">Boss Rush (Bosses Only)</option>
    </select>
  </div>
</div>

<div class="gallery-menu">
  <button class="close-settings">&#xd7;</button>
  <h2>Cat Gallery</h2>
  <div class="gallery-grid">
    <!-- Gallery items will be populated by JavaScript -->
  </div>
</div>

<div class="boss-info-menu">
  <button class="close-settings">&#xd7;</button>
  <h2>Boss Information</h2>
  
  <div class="boss-info-item">
    <img src="images - 2024-11-29T090747.784.jpeg" class="boss-portrait" alt="Catbird Boss">
    <h3>&#x1f426; The Catbird</h3>
    <p>Appears every 10 rounds</p>
    <p>A mysterious being from another dimension that takes the form of a cat-bird hybrid.</p>
    <div class="boss-abilities">
      <li>Creates reality-bending clones that cause instant game over if clicked</li>
      <li>Rapidly changes the target cat you need to find</li>
      <li>Requires 7 hits to defeat</li>
      <li>Rewards 500 points upon defeat</li>
      <li>Moves in unpredictable patterns</li>
    </div>
  </div>
  
  <div class="boss-info-item">
    <img src="Gb-cCLaXYAAiGb1.png" class="boss-portrait" alt="False Kendrick Boss">
    <h3>&#x1f3a4; The False Kendrick</h3>
    <p>Appears every 20 rounds</p>
    <p>A mysterious entity that has taken the form of Kendrick Lamar Duckworth, but is merely an imitation attempting to harness his influence. Not the real artist.</p>
    <div class="boss-abilities">
      <li>Phase 1: Creates numerous size-changing clones to protect himself</li>
      <li>Phase 2: Fewer but deadly clones that cause instant game over</li>
      <li>Has 12 health points and regenerates health over time</li>
      <li>Spawns multiple regular cats as distractions</li>
      <li>Moves more erratically than the Catbird</li>
      <li>Target cat remains constant throughout the battle</li>   
      <li>Requires defeating both phases to win</li>
      <li>Rewards 1000 points upon defeat</li>
    </div>
  </div>
</div>

<div id="loadingScreen" class="loading-screen">
  <div class="loading-spinner"></div>
  <h2>Initializing Cat Party Dimension...</h2>
  <p>Loading assets and preparing the cat dimension...</p>
  <div class="tips-container">
    <h3>Welcome to Cat Party!</h3>
    <p class="tip active">&#x1f431; A mysterious interdimensional cat party has broken loose! Can you help catch them all?</p>
    <p class="tip">&#x1f440; Keep your eyes on the target cat as they dance through dimensions!</p>
    <p class="tip">&#x1f3af; Click the correct cat to score 100 points and restore order to reality</p>
    <p class="tip">&#x26a0;&#xfe0f; Be careful! Wrong clicks drain 50-60 points of your cosmic energy</p>
    <p class="tip">&#x1f300; Every 3 rounds, the cats learn new dimensional movement patterns!</p>
    <p class="tip">&#x2694;&#xfe0f; Every 10 rounds, the Catbird Boss appears to challenge you!</p>
    <p class="tip">&#x1f4ab; The Catbird Boss can create reality-bending clones - avoid them at all costs!</p>
    <p class="tip">&#x1f52e; Hit the Catbird Boss 7 times to banish it back to its dimension</p>
    <p class="tip">&#x1f4aa; Surviving longer means more cats to track - stay focused!</p>
    <p class="tip">&#x2b50; Higher rounds mean higher stakes - penalties increase every 5 rounds!</p>
    <p class="tip">&#x1f31f; Legend says only the greatest cat herders can reach round 20...</p>
    <p class="tip">&#x1f6ab; The Catbird Boss comes from beyond our reality - it doesn't belong in our dimension!</p>
    <p class="tip">&#x1f3ad; Each cat has its own personality and movement style!</p>
    <p class="tip">&#x1f308; The dimensional barriers weaken as rounds progress...</p>
    <p class="tip">&#x26a1; Quick reflexes and keen eyes are your best tools!</p>
    <p class="tip">&#x1f3aa; Welcome to the greatest interdimensional cat circus!</p>
  </div>
</div>

<div class="target-display">
  <h2>Find this cat:</h2>
  <img id="targetCat" class="target-cat">
  <div id="statusDisplay" class="status-display"></div>
</div>
<div class="game-container" id="gameContainer">
  <div class="round-info">Round: <span id="roundDisplay">1</span></div>
  <div class="score">Score: <span id="scoreDisplay">0</span></div>
</div>

<div class="disclaimer">
  <p>&#x26a0;&#xfe0f; Image Disclaimer: The cat images used in this game are not owned by us. They have been sourced from various public domains including Google Images, Street Cat Wiki, and the Silly Cat TV Series Wiki. All rights belong to their respective owners.</p>
  <p>&#x1f3b5; Music Credits: Background music &quot;Hotel&quot; by Toby Fox and boss battle music &quot;Looking Glass Luminescence&quot; by AZALI. All music rights belong to their respective creators. This game is created for entertainment purposes only.</p>
</div>

<audio id="backgroundMusic" loop>
  <source src="Undertale OST_ 054 - Hotel [ ezmp3.cc ].mp3" type="audio/mpeg">
</audio>
<audio id="bossBattleMusic" loop>
  <source src="LOOKING GLASS LUMINESCENCE.mp3" type="audio/mpeg">
</audio>
<audio id="catClickSound">
  <source src="philly-hit.mp3" type="audio/mpeg">
</audio>

<script>const BOSS_DIALOGUES = {
  catbird: [" Hoo... are you?", " My clones will peck at your soul!", "Meowl at the moon!", " Watch your whiskers!", " Neither cat nor bird, but something more..."],
  kendrick: {
    phase1: ["I remember you was conflicted...", "Every cat is a star...", "This cat got nine lives...", "I got loyalty inside my DNA", "The cat don't die..."],
    phase2: ["I'm mad, but I ain't stressin'", "True friends, one question...", "Life ain't always what it seems...", "The ghost of Mandela...", "For Free? (Not quite...)"]
  }
};
const cats = ['Apple_Cat.jpg', 'red-cat-looking-around-outdoor-photo.jpg', 'silly-cat.png', 'silly-kitty-3-v0-4grm3kfbym1c1.jpg', '040c94639d8e9daa9f8255653059e926.jpg', 'show-me-your-silly-cats-v0-wplu39sp6l1d1.jpg', '1699074390109e4affb6f6d5369567425987fe8472a4c.jpg', '8q7uek.jpg', 'Buh.png', 'Gakster.png', 'Kitler.png', 'Flower_Cat.png', 'images_app_goo_gl__9mZFqXqgvYTUMNANA.png'];
const BOSS_CAT = 'images - 2024-11-29T090747.784.jpeg';
let bossHealth = 7;
let lastValidScore = 0;
let bossCloneCount = 0;
let currentPenalty = 50;
let cycleInterval;
let kendrickPhase = 1;
let kendrickPhaseTransitioned = false;
let highestRound = localStorage.getItem('highestRound') || 0;
let highestScore = localStorage.getItem('highestScore') || 0;
let settings = {
  flashingEnabled: true,
  bgMusicEnabled: true,
  soundEffectsEnabled: true,
  bgMusicVolume: 0.3,
  sfxVolume: 0.2,
  gameMode: 'normal'
};
if (localStorage.getItem('gameSettings')) {
  settings = JSON.parse(localStorage.getItem('gameSettings'));
  document.getElementById('toggleFlashing').checked = settings.flashingEnabled;
  document.getElementById('toggleBgMusic').checked = settings.bgMusicEnabled;
  document.getElementById('toggleSoundEffects').checked = settings.soundEffectsEnabled;
  document.getElementById('bgMusicVolume').value = settings.bgMusicVolume * 100;
  document.getElementById('sfxVolume').value = settings.sfxVolume * 100;
  document.getElementById('gameMode').value = settings.gameMode || 'normal';
}
document.querySelector('.settings-button').addEventListener('click', () => {
  document.querySelector('.settings-overlay').classList.add('active');
  document.querySelector('.settings-menu').classList.add('active');
});
document.querySelector('.boss-info-button').addEventListener('click', () => {
  document.querySelector('.settings-overlay').classList.add('active');
  document.querySelector('.boss-info-menu').classList.add('active');
});
document.querySelector('.close-settings').addEventListener('click', closeSettings);
document.querySelector('.settings-overlay').addEventListener('click', closeSettings);
document.querySelector('.gallery-button').addEventListener('click', () => {
  document.querySelector('.settings-overlay').classList.add('active');
  document.querySelector('.gallery-menu').classList.add('active');
  const gallery = document.querySelector('.gallery-grid');
  gallery.innerHTML = '';
  const catsTitle = document.createElement('div');
  catsTitle.className = 'gallery-section-title';
  catsTitle.innerHTML = '<h3>Cats</h3>';
  catsTitle.style.gridColumn = '1 / -1';
  gallery.appendChild(catsTitle);
  cats.forEach(cat => {
    const item = document.createElement('div');
    item.className = 'gallery-item';
    item.innerHTML = `
      <img src="${cat}" alt="Cat">
      <p>Regular Cat</p>
    `;
    gallery.appendChild(item);
  });
  const patternsTitle = document.createElement('div');
  patternsTitle.className = 'gallery-section-title';
  patternsTitle.innerHTML = '<h3>Movement Patterns</h3>';
  patternsTitle.style.gridColumn = '1 / -1';
  gallery.appendChild(patternsTitle);
  const patterns = {
    'linear': 'Cats move in straight lines to random positions',
    'circular': 'Cats move in circular patterns around the center',
    'zigzag': 'Cats move in quick, unpredictable zigzag patterns',
    'cat :3': 'Cats move to form a cat face pattern (rare)',
    'find luigi': 'Cats move in 8 fixed directions, bouncing off walls',
    'tlop': 'Many cats appear and teleport randomly',
    'why': 'Group A moves upward, Group B moves right',
    'shuffle': 'Randomly switches between all other patterns',
    'outside the box': 'Target cat appears in an unexpected place...',
    'where is he???': 'The target becomes quite... noticeable',
    'boss': 'Fast, erratic movement used by bosses'
  };
  Object.entries(patterns).forEach(([pattern, description]) => {
    const patternItem = document.createElement('div');
    patternItem.className = 'gallery-pattern-item';
    patternItem.innerHTML = `
      <div class="pattern-preview ${pattern.replace(/\s+/g, '-')}">
        <div class="preview-dot"></div>
      </div>
      <h4>${pattern}</h4>
      <p>${description}</p>
    `;
    gallery.appendChild(patternItem);
  });
});
function closeSettings() {
  document.querySelector('.settings-overlay').classList.remove('active');
  document.querySelector('.settings-menu').classList.remove('active');
  document.querySelector('.boss-info-menu').classList.remove('active');
  document.querySelector('.gallery-menu').classList.remove('active');
}
function saveSettings() {
  localStorage.setItem('gameSettings', JSON.stringify(settings));
}
document.getElementById('toggleFlashing').addEventListener('change', e => {
  settings.flashingEnabled = e.target.checked;
  saveSettings();
  if (!settings.flashingEnabled) {
    document.querySelectorAll('.glitch').forEach(el => el.classList.remove('glitch'));
    document.querySelectorAll('.cat-spin').forEach(el => el.classList.remove('cat-spin'));
  } else if (isBossBattle) {
    document.getElementById('targetCat').classList.add('glitch');
  }
});
document.getElementById('toggleBgMusic').addEventListener('change', e => {
  settings.bgMusicEnabled = e.target.checked;
  saveSettings();
  if (settings.bgMusicEnabled) {
    if (!isBossBattle) startBackgroundMusic();else startBossBattleMusic();
  } else {
    stopBackgroundMusic();
    stopBossBattleMusic();
  }
});
document.getElementById('toggleSoundEffects').addEventListener('change', e => {
  settings.soundEffectsEnabled = e.target.checked;
  saveSettings();
});
document.getElementById('bgMusicVolume').addEventListener('input', e => {
  settings.bgMusicVolume = e.target.value / 100;
  document.getElementById('backgroundMusic').volume = settings.bgMusicVolume;
  document.getElementById('bossBattleMusic').volume = settings.bgMusicVolume;
  saveSettings();
});
document.getElementById('sfxVolume').addEventListener('input', e => {
  settings.sfxVolume = e.target.value / 100;
  document.getElementById('catClickSound').volume = settings.sfxVolume;
  saveSettings();
});
document.getElementById('gameMode').addEventListener('change', e => {
  settings.gameMode = e.target.value;
  saveSettings();
  restartGame();
});
function addSpinAnimation(element) {
  if (!settings.flashingEnabled) return;
  element.classList.add('cat-spin');
  element.addEventListener('animationend', () => {
    element.classList.remove('cat-spin');
  });
}
const movementPatterns = {
  linear: cat => {
    const pos = randomPosition();
    cat.style.transition = 'all 2s linear';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
  },
  circular: cat => {
    const centerX = gameContainer.clientWidth / 2;
    const centerY = gameContainer.clientHeight / 2;
    const radius = Math.min(centerX, centerY) / 2;
    const angle = Math.random() * Math.PI * 2;
    cat.style.transition = 'all 2s ease-in-out';
    cat.style.left = centerX + radius * Math.cos(angle) + 'px';
    cat.style.top = centerY + radius * Math.sin(angle) + 'px';
  },
  zigzag: cat => {
    const pos = randomPosition();
    cat.style.transition = 'all 1s cubic-bezier(.6,.03,.4,.97)';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
  },
  boss: cat => {
    const pos = randomPosition();
    cat.style.transition = 'all 0.8s cubic-bezier(.17,.67,.83,.67)';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
  },
  "cat :3": cat => {
    const containerWidth = gameContainer.clientWidth;
    const containerHeight = gameContainer.clientHeight;
    const centerX = containerWidth / 2;
    const centerY = containerHeight / 2;
    const catFacePoints = [{
      x: centerX - 50,
      y: centerY - 20
    }, {
      x: centerX + 50,
      y: centerY - 20
    }, {
      x: centerX - 30,
      y: centerY + 20
    }, {
      x: centerX,
      y: centerY + 25
    }, {
      x: centerX + 30,
      y: centerY + 20
    }, {
      x: centerX - 40,
      y: centerY
    }, {
      x: centerX + 40,
      y: centerY
    }, {
      x: centerX,
      y: centerY - 30
    }];
    const point = catFacePoints[Math.floor(Math.random() * catFacePoints.length)];
    const variation = 10;
    const finalX = point.x + (Math.random() * variation - variation / 2);
    const finalY = point.y + (Math.random() * variation - variation / 2);
    cat.style.transition = 'all 1.5s cubic-bezier(.45,.05,.55,.95)';
    cat.style.left = Math.max(0, Math.min(finalX, containerWidth - 60)) + 'px';
    cat.style.top = Math.max(0, Math.min(finalY, containerHeight - 60)) + 'px';
  },
  "find luigi": cat => {
    if (!cat.dataset.direction) {
      const angles = [0, 45, 90, 135, 180, 225, 270, 315];
      const randomAngle = angles[Math.floor(Math.random() * angles.length)];
      cat.dataset.direction = randomAngle;
      cat.dataset.speed = '5';
    }
    if (!cat.dataset.luigiInterval) {
      cat.dataset.luigiInterval = 'active';
      const moveLuigiStyle = () => {
        if (!cat.dataset.direction) return;
        const angle = parseFloat(cat.dataset.direction);
        const speed = parseFloat(cat.dataset.speed);
        const radians = angle * Math.PI / 180;
        let currentX = parseFloat(cat.style.left);
        let currentY = parseFloat(cat.style.top);
        const deltaX = Math.cos(radians) * speed;
        const deltaY = Math.sin(radians) * speed;
        currentX += deltaX;
        currentY += deltaY;
        const containerWidth = gameContainer.clientWidth - cat.clientWidth;
        const containerHeight = gameContainer.clientHeight - cat.clientHeight;
        let newAngle = angle;
        if (currentX <= 0) {
          currentX = 0;
          newAngle = 180 - angle;
        } else if (currentX >= containerWidth) {
          currentX = containerWidth;
          newAngle = 180 - angle;
        }
        if (currentY <= 0) {
          currentY = 0;
          newAngle = 360 - angle;
        } else if (currentY >= containerHeight) {
          currentY = containerHeight;
          newAngle = 360 - angle;
        }
        newAngle = (newAngle % 360 + 360) % 360;
        cat.dataset.direction = newAngle;
        cat.style.transition = 'none';
        cat.style.left = currentX + 'px';
        cat.style.top = currentY + 'px';
        if (cat.parentElement) {
          requestAnimationFrame(moveLuigiStyle);
        }
      };
      requestAnimationFrame(moveLuigiStyle);
    }
  },
  "tlop": cat => {
    const pos = randomPosition();
    cat.style.transition = 'none';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
  },
  "why": cat => {
    if (!cat.dataset.whyGroup) {
      cat.dataset.whyGroup = Math.random() < 0.5 ? 'A' : 'B';
      const pos = randomPosition();
      cat.style.left = pos.x + 'px';
      cat.style.top = pos.y + 'px';
    }
    if (!cat.dataset.whyInterval) {
      cat.dataset.whyInterval = 'active';
      const moveWhy = () => {
        if (!cat.dataset.whyGroup) return;
        const speed = 3;
        let currentX = parseFloat(cat.style.left);
        let currentY = parseFloat(cat.style.top);
        if (cat.dataset.whyGroup === 'A') {
          currentY -= speed;
          if (currentY < -60) {
            currentY = gameContainer.clientHeight;
          }
        } else {
          currentX += speed;
          if (currentX > gameContainer.clientWidth) {
            currentX = -60;
          }
        }
        cat.style.transition = 'none';
        cat.style.left = currentX + 'px';
        cat.style.top = currentY + 'px';
        if (cat.parentElement) {
          requestAnimationFrame(moveWhy);
        }
      };
      requestAnimationFrame(moveWhy);
    }
  },
  "shuffle": cat => {
    const patterns = Object.keys(movementPatterns).filter(p => p !== 'shuffle');
    const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
    movementPatterns[randomPattern](cat);
  },
  "outside the box": cat => {
    const pos = randomPosition();
    cat.style.transition = 'all 1s ease';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
  },
  "where is he???": cat => {
    const pos = randomPosition();
    cat.style.transition = 'all 1.5s ease-in-out';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
    // Only add class if this is the target cat
    if (cat.src.includes(targetCat)) {
        cat.classList.add('where-is-he');
    }
  },
};
function updateMovementPattern() {
  const patterns = ['linear', 'linear', 'circular', 'circular', 'zigzag', 'zigzag', 'cat :3', 'find luigi', 'find luigi', 'tlop', 'tlop', 'tlop', 'tlop', 'why', 'why', 'shuffle', 'shuffle', 'outside the box', 'where is he???'];
  let newPattern;
  do {
    newPattern = patterns[Math.floor(Math.random() * patterns.length)];
  } while (newPattern === currentPattern && patterns.length > 1);
  currentPattern = newPattern;
  statusDisplay.textContent = `New movement pattern: ${currentPattern}!`;
  if (currentPattern === "outside the box") {
    statusDisplay.textContent = "New pattern: outside the box! Think differently...";
  }
  const allCats = document.querySelectorAll('.cat:not(.boss-cat):not(.boss-clone)');
  allCats.forEach(cat => {
    if (currentPattern === 'tlop') {
      const numExtraCats = 67;
      for (let i = 0; i < numExtraCats; i++) {
        let randomCat;
        do {
          randomCat = cats[Math.floor(Math.random() * cats.length)];
        } while (randomCat === targetCat);
        gameContainer.appendChild(createCat(randomCat, false));
      }
    } else {
      movementPatterns[currentPattern](cat);
    }
  });
}
let score = 0;
let currentRound = 1;
let targetCat = '';
let moveInterval;
let cloneInterval;
let currentPattern = 'linear';
let isBossBattle = false;
const gameContainer = document.getElementById('gameContainer');
const statusDisplay = document.getElementById('statusDisplay');
function startBackgroundMusic() {
  if (!settings.bgMusicEnabled) return;
  const bgMusic = document.getElementById('backgroundMusic');
  bgMusic.volume = settings.bgMusicVolume;
  bgMusic.play().catch(error => {
    console.log("Audio playback failed:", error);
  });
}
function stopBackgroundMusic() {
  const bgMusic = document.getElementById('backgroundMusic');
  bgMusic.pause();
  bgMusic.currentTime = 0;
}
function startBossBattleMusic() {
  if (!settings.bgMusicEnabled) return;
  const bossBattleMusic = document.getElementById('bossBattleMusic');
  bossBattleMusic.volume = settings.bgMusicVolume;
  bossBattleMusic.play().catch(error => {
    console.log("Boss battle audio playback failed:", error);
  });
}
function stopBossBattleMusic() {
  const bossBattleMusic = document.getElementById('bossBattleMusic');
  bossBattleMusic.pause();
  bossBattleMusic.currentTime = 0;
}
function playCatClickSound() {
  if (!settings.soundEffectsEnabled) return;
  const clickSound = document.getElementById('catClickSound');
  clickSound.currentTime = 0;
  clickSound.volume = settings.sfxVolume;
  clickSound.play().catch(error => {
    console.log("Click sound playback failed:", error);
  });
}
function endBossBattle() {
  isBossBattle = false;
  gameContainer.classList.remove('boss-mode');
  stopBossBattleMusic();
  startBackgroundMusic();
  const targetCatImg = document.getElementById('targetCat');
  targetCatImg.classList.remove('glitch');
  const clones = document.querySelectorAll('.boss-clone');
  clones.forEach(clone => clone.remove());
  if (moveInterval) clearInterval(moveInterval);
  if (cloneInterval) clearInterval(cloneInterval);
  bossCloneCount = 0;
}
function createBossClone() {
  if (!isBossBattle || bossCloneCount >= (kendrickPhase === 1 ? 12 : 6)) return;
  bossCloneCount++;
  const isKendrickBattle = currentRound % 20 === 0;
  const clone = document.createElement('img');
  clone.src = isKendrickBattle ? 'Gb-cCLaXYAAiGb1.png' : BOSS_CAT;
  clone.className = 'cat boss-clone';
  const pos = randomPosition();
  clone.style.left = pos.x + 'px';
  clone.style.top = pos.y + 'px';
  if (isKendrickBattle) {
    if (kendrickPhase === 1) {
      setInterval(() => {
        if (!isBossBattle) return;
        const size = 40 + Math.random() * 80;
        clone.style.width = `${size}px`;
        clone.style.height = `${size}px`;
      }, 800);
    } else {
      clone.addEventListener('click', () => {
        lastValidScore = score;
        score = 0;
        document.getElementById('scoreDisplay').textContent = score;
        statusDisplay.textContent = "Game Over! False Kendrick's clone caught you!";
        endBossBattle();
        showGameOver(lastValidScore);
      });
    }
  } else {
    clone.addEventListener('click', () => {
      lastValidScore = score;
      score = 0;
      document.getElementById('scoreDisplay').textContent = score;
      statusDisplay.textContent = "Game Over! Boss clone clicked!";
      endBossBattle();
      showGameOver(lastValidScore);
    });
  }
  gameContainer.appendChild(clone);
  const cloneMoveInterval = setInterval(() => {
    if (!isBossBattle) {
      clearInterval(cloneMoveInterval);
      return;
    }
    if (isKendrickBattle) {
      const patterns = ['boss', 'zigzag', 'circular'];
      const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
      movementPatterns[randomPattern](clone);
    } else {
      movementPatterns.boss(clone);
    }
  }, isKendrickBattle ? 1000 : 1200);
}
function preloadAssets(callback) {
  let totalAssets = cats.length + 4;
  let loadedAssets = 0;
  function assetLoaded() {
    loadedAssets++;
    if (loadedAssets === totalAssets) {
      callback();
    }
  }
  cats.forEach(src => {
    const img = new Image();
    img.onload = assetLoaded;
    img.onerror = assetLoaded;
    img.src = src;
  });
  const bossImg = new Image();
  bossImg.onload = assetLoaded;
  bossImg.onerror = assetLoaded;
  bossImg.src = BOSS_CAT;
  const audioFiles = ['Undertale OST_ 054 - Hotel [ ezmp3.cc ].mp3', 'LOOKING GLASS LUMINESCENCE.mp3', 'philly-hit.mp3'];
  audioFiles.forEach(audioSrc => {
    const audio = new Audio();
    audio.addEventListener('canplaythrough', assetLoaded, {
      once: true
    });
    audio.addEventListener('error', assetLoaded, {
      once: true
    });
    audio.src = audioSrc;
    audio.preload = 'auto';
  });
}
function randomPosition() {
  const catSize = window.innerWidth <= 480 ? 50 : 60;
  const maxX = gameContainer.clientWidth - catSize;
  const maxY = gameContainer.clientHeight - catSize;
  return {
    x: Math.random() * maxX,
    y: Math.random() * maxY
  };
}
function createCat(imageSrc, isTarget) {
  const cat = document.createElement('img');
  cat.src = imageSrc;
  cat.className = 'cat';
  const pos = randomPosition();
  cat.style.left = pos.x + 'px';
  cat.style.top = pos.y + 'px';
  const originalRemove = cat.remove.bind(cat);
  cat.remove = function () {
    delete this.dataset.direction;
    delete this.dataset.luigiInterval;
    delete this.dataset.whyGroup;
    delete this.dataset.whyInterval;
    originalRemove();
  };
  if (isTarget && !isBossBattle) {
    cat.addEventListener('click', () => {
      playCatClickSound();
      addSpinAnimation(cat);
      score += 100;
      lastValidScore = score;
      document.getElementById('scoreDisplay').textContent = score;
      startNewLevel();
    });
  } else if (!isTarget) {
    cat.addEventListener('click', () => {
      playCatClickSound();
      addSpinAnimation(cat);
      lastValidScore = score;
      score -= currentPenalty;
      document.getElementById('scoreDisplay').textContent = score;
      if (score <= 0) {
        score = 0;
        document.getElementById('scoreDisplay').textContent = score;
        clearInterval(moveInterval);
        clearInterval(cloneInterval);
        showGameOver(lastValidScore);
      }
    });
  }
  return cat;
}
function calculateDifficulty(numCats, pattern) {
  let difficulty = 0;
  if (settings.gameMode === 'chill') {
    if (numCats <= 7) difficulty += 1;else if (numCats <= 9) difficulty += 2;else if (numCats <= 11) difficulty += 3;else difficulty += 4;
  } else {
    if (numCats <= 9) difficulty += 1;else if (numCats <= 11) difficulty += 2;else if (numCats <= 13) difficulty += 3;else if (numCats <= 14) difficulty += 4;else difficulty += 5;
  }
  const patternDifficulty = {
    'linear': 1,
    'circular': 2,
    'zigzag': 3,
    'cat :3': 4,
    'boss': 5,
    'find luigi': 5,
    'tlop': 1,
    'why': 4,
    'shuffle': 5,
    'outside the box': 6,
    'where is he???': 1
  };
  difficulty += patternDifficulty[pattern] || 1;
  if (settings.gameMode === 'chill') {
    difficulty = Math.max(1, difficulty - 1);
  }
  const totalDifficulty = Math.min(6, Math.round(difficulty / 2));
  const difficultyText = {
    1: 'easy',
    2: 'medium',
    3: 'hard',
    4: 'insane',
    5: 'madness',
    6: 'why'
  };
  return difficultyText[totalDifficulty] || 'easy';
}
function updateDifficultyMeter(numCats, pattern) {
  const difficulty = calculateDifficulty(numCats, pattern);
  const oldMeter = gameContainer.querySelector('.difficulty-meter');
  if (oldMeter) oldMeter.remove();
  const meter = document.createElement('div');
  meter.className = 'difficulty-meter';
  const difficultyColors = {
    'easy': '#2ecc71',
    'medium': '#f1c40f',
    'hard': '#e67e22',
    'insane': '#e74c3c',
    'madness': '#9b59b6',
    'why': '#c0392b'
  };
  meter.innerHTML = `
    Difficulty: <span style="color: ${difficultyColors[difficulty]}; font-weight: bold; text-transform: uppercase;">${difficulty}</span>
  `;
  gameContainer.appendChild(meter);
}
function moveCats() {
  const allCats = document.querySelectorAll('.cat:not(.boss-cat):not(.boss-clone)');
  allCats.forEach(cat => {
    movementPatterns[currentPattern](cat);
  });
}
function startNewLevel() {
  if (moveInterval) {
    clearInterval(moveInterval);
  }
  if (cloneInterval) {
    clearInterval(cloneInterval);
  }
  currentRound++;
  document.getElementById('roundDisplay').textContent = currentRound;
  updateLeaderboard();
  const targetCatImg = document.getElementById('targetCat');
  targetCatImg.classList.remove('glitch');
  document.querySelectorAll('.where-is-he').forEach(cat => {
    if (cat.src.includes(targetCat)) {
        cat.classList.remove('where-is-he');
    }
  });
  if (settings.gameMode === 'bossrush') {
    startBossBattle();
    return;
  }
  if (settings.gameMode === 'chill') {
    currentPenalty = 40;
  } else {
    if (currentRound % 5 === 0) {
      currentPenalty = 60;
      statusDisplay.textContent = `Warning: Increased penalty (${currentPenalty} points)!`;
    } else {
      currentPenalty = 50;
    }
  }
  if (currentRound % 3 === 0) {
    updateMovementPattern();
  }
  if (currentRound % 10 === 0 && settings.gameMode === 'normal') {
    startBossBattle();
    return;
  }
  gameContainer.classList.remove('boss-mode');
  gameContainer.innerHTML = `
    <div class="round-info">Round: <span id="roundDisplay">${currentRound}</span></div>
    <div class="score">Score: <span id="scoreDisplay">${score}</span></div>
  `;
  let numCats;
  if (settings.gameMode === 'chill') {
    numCats = Math.min(6 + Math.floor(currentRound / 3), 12);
  } else {
    numCats = Math.min(8 + Math.floor(currentRound / 2), 15);
  }
  targetCat = cats[Math.floor(Math.random() * cats.length)];
  document.getElementById('targetCat').src = targetCat;
  if (currentPattern === "outside the box") {
    document.getElementById('targetCat').style.cursor = 'pointer';
    document.getElementById('targetCat').onclick = () => {
      playCatClickSound();
      addSpinAnimation(document.getElementById('targetCat'));
      score += 100;
      lastValidScore = score;
      document.getElementById('scoreDisplay').textContent = score;
      startNewLevel();
    };
  } else {
    document.getElementById('targetCat').style.cursor = 'default';
    document.getElementById('targetCat').onclick = null;
    gameContainer.appendChild(createCat(targetCat, true));
  }
  for (let i = 0; i < numCats - 1; i++) {
    let randomCat;
    do {
      randomCat = cats[Math.floor(Math.random() * cats.length)];
    } while (randomCat === targetCat);
    gameContainer.appendChild(createCat(randomCat, false));
  }
  updateDifficultyMeter(numCats, currentPattern);
  moveInterval = setInterval(moveCats, 2000);
}
function updateBossDialogue(bossType, phase = null) {
  const bossText = document.querySelector('.boss-text');
  if (!bossText) return;
  let dialogue;
  if (bossType === 'kendrick') {
    const phaseDialogues = phase === 2 ? BOSS_DIALOGUES.kendrick.phase2 : BOSS_DIALOGUES.kendrick.phase1;
    dialogue = phaseDialogues[Math.floor(Math.random() * phaseDialogues.length)];
  } else {
    dialogue = BOSS_DIALOGUES.catbird[Math.floor(Math.random() * BOSS_DIALOGUES.catbird.length)];
  }
  bossText.innerHTML = `Health: ${bossHealth}<br><span style="font-size: 0.9em; color: #f1c40f">${dialogue}</span>`;
}
function startBossBattle() {
  isBossBattle = true;
  bossHealth = currentRound % 20 === 0 ? 12 : 7;
  kendrickPhase = 1;
  kendrickPhaseTransitioned = false;
  gameContainer.classList.add('boss-mode');
  stopBackgroundMusic();
  startBossBattleMusic();
  gameContainer.innerHTML = `
    <div class="round-info">Round: <span id="roundDisplay">${currentRound}</span></div>
    <div class="score">Score: <span id="scoreDisplay">${score}</span></div>
    <div class="boss-text">Health: ${bossHealth}</div>
  `;
  const isKendrickBattle = currentRound % 20 === 0;
  const bossCat = document.createElement('img');
  bossCat.src = isKendrickBattle ? 'Gb-cCLaXYAAiGb1.png' : BOSS_CAT;
  bossCat.className = 'cat boss-cat';
  document.getElementById('targetCat').src = bossCat.src;
  if (settings.flashingEnabled) {
    document.getElementById('targetCat').classList.add('glitch');
  }
  const pos = randomPosition();
  bossCat.style.left = pos.x + 'px';
  bossCat.style.top = pos.y + 'px';
  let healingInterval;
  if (isKendrickBattle) {
    healingInterval = setInterval(() => {
      if (!isBossBattle) {
        clearInterval(healingInterval);
        return;
      }
      if (bossHealth < (kendrickPhase === 1 ? 12 : 6)) {
        bossHealth++;
        updateBossDialogue('kendrick', kendrickPhase);
      }
    }, 3000);
  }
  bossCat.addEventListener('click', () => {
    if (bossCat.classList.contains('immunity')) return;
    playCatClickSound();
    bossHealth--;
    bossCat.classList.add('immunity');
    setTimeout(() => {
      bossCat.classList.remove('immunity');
    }, 500);
    if (isKendrickBattle && bossHealth <= 0 && kendrickPhase === 1) {
      bossHealth = 12;
      kendrickPhase = 2;
      kendrickPhaseTransitioned = true;
      const clones = document.querySelectorAll('.boss-clone');
      clones.forEach(clone => clone.remove());
      bossCloneCount = 0;
      if (settings.flashingEnabled) {
        gameContainer.style.animation = 'flash 0.5s';
        setTimeout(() => {
          gameContainer.style.animation = '';
        }, 500);
      }
      statusDisplay.textContent = "Kendrick has entered Phase 2!";
    } else if (bossHealth <= 0) {
      if (isKendrickBattle) {
        clearInterval(healingInterval);
      }
      score += isKendrickBattle ? 1000 : 500;
      lastValidScore = score;
      document.getElementById('scoreDisplay').textContent = score;
      statusDisplay.textContent = `Boss defeated! +${isKendrickBattle ? 1000 : 500} points!`;
      endBossBattle();
      startNewLevel();
      return;
    }
    updateBossDialogue(isKendrickBattle ? 'kendrick' : 'catbird', kendrickPhase);
  });
  gameContainer.appendChild(bossCat);
  moveInterval = setInterval(() => {
    if (!isBossBattle) {
      clearInterval(moveInterval);
      return;
    }
    movementPatterns.boss(bossCat);
  }, 1000);
  cloneInterval = setInterval(() => {
    if (!isBossBattle) {
      clearInterval(cloneInterval);
      return;
    }
    createBossClone();
  }, currentRound % 20 === 0 ? 2000 : 1200);
  const dialogueInterval = setInterval(() => {
    if (!isBossBattle) {
      clearInterval(dialogueInterval);
      return;
    }
    updateBossDialogue(isKendrickBattle ? 'kendrick' : 'catbird', kendrickPhase);
  }, 3000);
}
function showGameOver(finalScore) {
  updateLeaderboard();
  stopBackgroundMusic();
  stopBossBattleMusic();
  const gameOverScreen = document.createElement('div');
  gameOverScreen.className = 'game-over-screen';
  gameOverScreen.innerHTML = `
    <h2>Game Over!</h2>
    <p>Your final score: ${finalScore}</p>
    <p>You made it to round ${currentRound}</p>
    <button class="restart-button" onclick="restartGame()">Try Again</button>
  `;
  document.body.appendChild(gameOverScreen);
}
function restartGame() {
  startBackgroundMusic();
  const gameOverScreen = document.querySelector('.game-over-screen');
  if (gameOverScreen) {
    gameOverScreen.remove();
  }
  currentPenalty = 50;
  score = 0;
  lastValidScore = 0;
  currentRound = 1;
  document.getElementById('scoreDisplay').textContent = score;
  document.getElementById('roundDisplay').textContent = currentRound;
  if (moveInterval) clearInterval(moveInterval);
  if (cloneInterval) clearInterval(cloneInterval);
  gameContainer.classList.remove('boss-mode');
  updateMovementPattern();
  startNewLevel();
}
function updateLeaderboard() {
  if (currentRound > highestRound) {
    highestRound = currentRound;
    localStorage.setItem('highestRound', highestRound);
  }
  if (score > highestScore) {
    highestScore = score;
    localStorage.setItem('highestScore', highestScore);
  }
  document.getElementById('highestRound').textContent = highestRound;
  document.getElementById('highestScore').textContent = highestScore;
}
function cycleTips() {
  const tips = document.querySelectorAll('.tip');
  let activeTip = Math.floor(Math.random() * tips.length);
  setInterval(() => {
    tips.forEach(tip => tip.classList.remove('active'));
    tips[activeTip].classList.add('active');
    activeTip = Math.floor(Math.random() * tips.length);
  }, 3000);
}
window.addEventListener('resize', () => {
  const allCats = document.querySelectorAll('.cat');
  allCats.forEach(cat => {
    const pos = randomPosition();
    cat.style.transition = 'none';
    cat.style.left = pos.x + 'px';
    cat.style.top = pos.y + 'px';
  });
});
preloadAssets(() => {
  document.getElementById('highestRound').textContent = highestRound;
  document.getElementById('highestScore').textContent = highestScore;
  setTimeout(() => {
    document.getElementById('loadingScreen').style.opacity = '0';
    cycleTips();
    setTimeout(() => {
      document.getElementById('loadingScreen').style.display = 'none';
      updateMovementPattern();
      startNewLevel();
      startBackgroundMusic();
    }, 500);
  }, 1500);
});</script>
</body></html>